import{a as G,b as V}from"./chunk-OXVNYH3J.js";import{d as L,e as $,g as z}from"./chunk-ACK5G3GU.js";import{a as H,b as J,c as W,d as A,e as X,f as Y,g as Z,h as R,i as ee,j as te,k as ie}from"./chunk-HX5WF7EH.js";import{$ as O,L as K,M as S,O as c,S as N,W as m,Y as u,_ as p,aa as j,ba as a,ca as o,da as _,e as q,ga as B,ha as v,j as Q,la as M,ma as s,na as b,o as C,oa as U,qa as x,t as y,ta as E,u as h,ua as T,v as P,x as I,za as D}from"./chunk-IPNFZVCL.js";import{a as F,b as w,d as k}from"./chunk-5VTWB77A.js";var re=(()=>{let t=class t{constructor(){this.ngForm=y(A,{self:!0}),this.shouldMarkAsPristine=C(!1),this.formValueChange=this.ngForm.form.valueChanges.pipe(Q(0)),this.invalidChange=this.formValueChange.pipe(q(()=>this.ngForm.invalid||!1)),N(()=>{if(this.shouldMarkAsPristine())for(let r of Object.keys(this.ngForm.controls))this.ngForm.controls[r].markAsPristine()})}};t.\u0275fac=function(n){return new(n||t)},t.\u0275dir=I({type:t,selectors:[["form"]],inputs:{shouldMarkAsPristine:[h.SignalBased,"shouldMarkAsPristine"]},outputs:{formValueChange:"formValueChange",invalidChange:"invalidChange"},standalone:!0});let e=t;return e})();function de(e,t){e&1&&(a(0,"div",12),s(1," Title is a required field "),o())}function le(e,t){e&1&&(a(0,"div",12),s(1," Minimum length of title is 3 "),o())}function ce(e,t){e&1&&(a(0,"div",12),s(1," Description is a required field "),o())}function me(e,t){e&1&&(a(0,"div",12),s(1," Price must be at least 0.1 "),o())}function ue(e,t){e&1&&(a(0,"div",12),s(1," Price is a required field "),o())}function pe(e,t){e&1&&(a(0,"p"),s(1,"Adding new product"),o())}function ge(e,t){if(e&1&&(a(0,"p"),s(1),o()),e&2){let f=v();c(),b(f.mutation.error().message)}}function fe(e,t){e&1&&(a(0,"p"),s(1,"New product created"),o())}var ne={title:"",description:"",price:1},ae=(()=>{let t=class t{constructor(){this.category=C.required(),this.categoryService=y(V),this.productService=y(z),this.formValue=S(ne),this.formInvalid=S(!1),this.shouldMarkAsPristine=S(!1),this.viewModel=K(()=>({formValue:this.formValue(),category:this.category(),image:"https://via.assets.so/img.jpg?w=100&h=100&tc=yellow&bg=blue&t=product",isFormDisabled:this.formInvalid()||this.mutation.isPending(),isControlDisabled:this.mutation.isPending()})),this.categoryProductsKey=["category_products"],this.mutation=L(r=>({mutationFn:n=>this.categoryService.addProduct(n),onMutate:n=>k(this,null,function*(){yield r.cancelQueries({queryKey:this.categoryProductsKey}),yield r.cancelQueries({queryKey:this.categoryKey});let i=w(F({},n),{id:this.productService.getNewProductId()}),d=this.optimisticUpdateCategoryProducts(r,i);return{previousAllProducts:this.optimisticUpdateAllProducts(r,i),previousCategoryProducts:d}}),onSettled:(n,i,d,l)=>{let g=l?.previousCategoryProducts,se=l?.previousAllProducts;i?(r.setQueryData(this.categoryKey,g),r.setQueryData(this.categoryProductsKey,se)):this.resetViewModel()}}))}get vm(){return this.viewModel()}get categoryKey(){return["categories",this.category()]}optimisticUpdateAllProducts(r,n){let i=r.getQueryData(this.categoryProductsKey);if(i){let d=i.map(l=>l.category===this.vm.category?{category:l.category,products:[...l.products,n]}:l);r.setQueryData(this.categoryProductsKey,d)}return i}optimisticUpdateCategoryProducts(r,n){let i=r.getQueryData(this.categoryKey);return i&&r.setQueryData(this.categoryKey,d=>[...d,n]),i}resetViewModel(){this.formValue.set(ne),this.shouldMarkAsPristine.set(!0)}createProduct(){this.shouldMarkAsPristine.set(!1);let{formValue:r,category:n,image:i}=this.vm,d={title:r.title||"",description:r.description||"",price:r.price||1,category:n,image:i};this.mutation.mutate(d)}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=P({type:t,selectors:[["app-create-product"]],inputs:{category:[h.SignalBased,"category"]},standalone:!0,features:[x],decls:33,vars:15,consts:[[3,"shouldMarkAsPristine","ngSubmit","formValueChange","invalidChange"],["for","name"],["name","title","id","title","required","","minlength","3",3,"ngModel","disabled"],["titleCtrl","ngModel"],["class","form-errors"],["for","description"],["name","description","id","description","rows","5","cols","50","required","",3,"ngModel","disabled"],["descriptionCtrl","ngModel"],["for","price"],["name","price","id","price","type","number","min","1","required","",3,"ngModel","disabled"],["priceCtrl","ngModel"],["type","submit",3,"disabled"],[1,"form-errors"]],template:function(n,i){if(n&1&&(a(0,"h3"),s(1),E(2,"titlecase"),o(),a(3,"form",0),B("ngSubmit",function(){return i.createProduct()})("formValueChange",function(l){return i.formValue.set(l)})("invalidChange",function(l){return i.formInvalid.set(l)}),a(4,"div")(5,"label",1)(6,"span"),s(7,"Title: "),o(),_(8,"input",2,3),o(),m(10,de,2,0,"div",4)(11,le,2,0),o(),a(12,"div")(13,"label",5)(14,"span"),s(15,"Description: "),o(),a(16,"textarea",6,7),s(18,"      "),o()(),m(19,ce,2,0,"div",4),o(),a(20,"div")(21,"label",8)(22,"span"),s(23,"Price: "),o(),_(24,"input",9,10),o(),m(26,me,2,0,"div",4)(27,ue,2,0),o(),a(28,"button",11),s(29,"Submit"),o(),m(30,pe,2,0,"p")(31,ge,2,1)(32,fe,2,0),o()),n&2){let d=M(9),l=M(17),g=M(25);c(),U("Create new product in ",T(2,13,i.vm.category),""),c(2),u("shouldMarkAsPristine",i.shouldMarkAsPristine()),c(5),u("ngModel",i.vm.formValue.title)("disabled",i.vm.isControlDisabled),c(2),p(10,d.errors!=null&&d.errors.required&&d.dirty?10:d.errors!=null&&d.errors.minlength&&d.dirty?11:-1),c(6),u("ngModel",i.vm.formValue.description)("disabled",i.vm.isControlDisabled),c(3),p(19,l.errors!=null&&l.errors.required&&l.dirty?19:-1),c(5),u("ngModel",i.vm.formValue.price)("disabled",i.vm.isControlDisabled),c(2),p(26,g.errors!=null&&g.errors.min&&g.dirty?26:g.errors!=null&&g.errors.required&&g.dirty?27:-1),c(2),u("disabled",i.vm.isFormDisabled),c(2),p(30,i.mutation.isPending()?30:i.mutation.isError()?31:i.mutation.isSuccess()?32:-1)}},dependencies:[ie,Y,H,Z,J,W,ee,te,R,X,A,D,re],styles:["form[_ngcontent-%COMP%]{padding:.75rem .5rem;border:1px solid black}form[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-bottom:.5rem}label[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{display:inline-block;width:20%}"],changeDetection:0});let e=t;return e})();function ye(e,t){e&1&&(a(0,"p"),s(1,"Loading..."),o())}function Ce(e,t){e&1&&(a(0,"p"),s(1,"Error"),o())}var he=(e,t)=>t.id;function _e(e,t){if(e&1&&_(0,"app-product",3),e&2){let f=t.$implicit;u("product",f)}}function ve(e,t){if(e&1&&(a(0,"div",2),O(1,_e,1,1,"app-product",3,he),o()),e&2){let f=v();c(),j(f)}}function Pe(e,t){e&1&&(a(0,"p"),s(1,"Category does not have products"),o())}function Se(e,t){e&1&&m(0,ve,3,0,"div",1)(1,Pe,2,0),e&2&&p(0,t.length>0?0:1)}function Me(e,t){if(e&1&&m(0,Se,2,1),e&2){let f=v(),r;p(0,(r=f.productsQuery.data())?0:-1,r)}}var Xe=(()=>{let t=class t{constructor(){this.categoryService=y(V),this.category=C(""),this.productsQuery=$(()=>({queryKey:["categories",this.category()],queryFn:()=>this.categoryService.getCategory(this.category())}))}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=P({type:t,selectors:[["app-category-products"]],inputs:{category:[h.SignalBased,"category"]},standalone:!0,features:[x],decls:7,vars:5,consts:[[3,"category"],["class","products"],[1,"products"],[3,"product"]],template:function(n,i){n&1&&(_(0,"app-create-product",0),a(1,"h2"),s(2),E(3,"titlecase"),o(),m(4,ye,2,0,"p")(5,Ce,2,0)(6,Me,1,1)),n&2&&(u("category",i.category()),c(2),b(T(3,3,i.category())),c(2),p(4,i.productsQuery.isPending()?4:i.productsQuery.isError()?5:i.productsQuery.isSuccess()?6:-1))},dependencies:[G,D,ae],styles:["div.products[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-content:stretch}app-product[_ngcontent-%COMP%]{flex-basis:250px;height:300px;margin-bottom:1rem}"],changeDetection:0});let e=t;return e})();export{Xe as CategoryProductsComponent};
